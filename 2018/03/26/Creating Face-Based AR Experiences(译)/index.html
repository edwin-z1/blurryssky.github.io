<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content="iOS">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          Creating Face-Based AR Experiences(è¯‘) - blurrysskyçš„åšå®¢ | blurryssky&#39;s Blog
        
    </title>

    <link rel="canonical" href="https://blurryssky.github.io/2018/03/26/Creating Face-Based AR Experiences(è¯‘)/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">blurryssky&#39;s blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="https://blurryssky.github.io/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-new-bg.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#iOSå¼€å‘" title="iOSå¼€å‘">iOSå¼€å‘</a>
                        
                          <a class="tag" href="/tags/#AR" title="AR">AR</a>
                        
                          <a class="tag" href="/tags/#ARKit(å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ï¼‰" title="ARKit(å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ï¼‰">ARKit(å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ï¼‰</a>
                        
                    </div>
                    <h1>Creating Face-Based AR Experiences(è¯‘)</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by blurryssky on
                        2018-03-26
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="æ–‡æ¡£åœ°å€"><a href="#æ–‡æ¡£åœ°å€" class="headerlink" title="æ–‡æ¡£åœ°å€"></a><a href="https://developer.apple.com/documentation/arkit/creating_face_based_ar_experiences" target="_blank" rel="noopener">æ–‡æ¡£åœ°å€</a></h1><p><strong>ğŸ˜‹ä½¿ç”¨ARKitæ¥åšäººè„¸è¯†åˆ«ï¼Œä¸€åˆ‡å˜å¾—ç®€å•ä¸å°‘ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è¶…å¤šçš„è„¸éƒ¨ç»†èŠ‚</strong></p>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>æ–‡æ¡£ä¸Šæœ‰sample appä¸‹è½½ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„UIï¼Œå…è®¸æˆ‘ä»¬åœ¨æœ‰TrueDepthå‰ç½®æ‘„åƒå¤´çš„è®¾å¤‡ä¸Š(ç›®å‰åªæœ‰iphoneX)ä¸Šåˆ‡æ¢é€‰æ‹©4ç§ARæ•ˆæœã€‚</p>
<ul>
<li>æ— ä»»ä½•ARæ•ˆæœçš„æ‘„åƒ</li>
<li>ç”±<code>ARKit</code>æä¾›çš„é¢éƒ¨ç½‘è†œï¼Œå¹¶ä¸”è‡ªåŠ¨é¢„ä¼°çœŸå®ä¸–ç•Œçš„æ–¹å‘å…‰çº¿ç¯å¢ƒã€‚</li>
<li>åœ¨ç”¨æˆ·é¢éƒ¨è´´ä¸Šè™šæ‹Ÿçš„3Då†…å®¹ï¼ˆ3Då†…å®¹å¯ä»¥è¢«ç”¨æˆ·çš„è„¸é®æŒ¡ï¼‰ã€‚</li>
<li>ä¸€ä¸ªä¼šè·Ÿç€ç”¨æˆ·é¢éƒ¨å˜åŒ–è€ŒåŠ¨ç”»çš„ç®€å•æœºå™¨äººã€‚</li>
</ul>
<h2 id="Start-a-Face-Tracking-Session-in-a-SceneKit-View"><a href="#Start-a-Face-Tracking-Session-in-a-SceneKit-View" class="headerlink" title="Start a Face Tracking Session in a SceneKit View"></a>Start a Face Tracking Session in a SceneKit View</h2><p>åƒå…¶ä»–çš„<code>ARKit</code>ç”¨æ³•ä¸€æ ·ï¼Œè„¸éƒ¨è·Ÿè¸ªéœ€è¦é…ç½®å’Œå¯åŠ¨<code>ARSession</code>å¯¹è±¡ï¼Œç„¶åæŠŠæ‘„åƒå›¾ç‰‡å’Œè™šæ‹Ÿå†…å®¹åœ¨ä¸€ä¸ª<em>view</em>ä¸Šæ¸²æŸ“ã€‚å…³äºæ›´å¤šçš„è®¾ç½®<em>session</em>å’Œ<em>view</em>çš„ç»†èŠ‚,è¯·çœ‹<a href>About Augmented Reality and ARKit</a>ã€<a href>Building Your First AR Experience</a>ã€‚è¿™é‡Œä½¿ç”¨<code>SceneKit</code>æ¥å±•ç¤ºARä½“éªŒï¼Œä¹Ÿå¯ä»¥ç”¨<code>SpriteKit</code>æˆ–ç”¨<code>Metal</code>æ‰“é€ è‡ªå®šä¹‰çš„æ¸²æŸ“å™¨ï¼Œè¯·çœ‹ï¼ˆ<a href>ARSKView and Displaying an AR Experience with Metal</a>ï¼‰ã€‚å¯ç”¨é¢éƒ¨è·Ÿè¸ªï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª<code>ARFaceTrackingConfiguration</code>å®ä¾‹ï¼Œé…ç½®å®ƒçš„å±æ€§ï¼ŒæŠŠå®ƒä¼ æœ‰<em>view</em>å…³è”çš„<code>ARSession</code>å¯¹è±¡çš„<strong>run(_:options:)</strong>æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="type">ARFaceTrackingConfiguration</span>.isSupported <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">let</span> configuration = <span class="type">ARFaceTrackingConfiguration</span>()</span><br><span class="line">configuration.isLightEstimationEnabled = <span class="literal">true</span></span><br><span class="line">session.run(configuration, options: [.resetTracking, .removeExistingAnchors])</span><br></pre></td></tr></table></figure>
<p>è®°å¾—ä½¿ç”¨<strong>ARFaceTrackingConfiguration.isSupported</strong>æ¥æ£€æŸ¥è®¾å¤‡æ˜¯å¦æ”¯æŒã€‚</p>
<h2 id="Track-the-Position-and-Orientation-of-a-Face"><a href="#Track-the-Position-and-Orientation-of-a-Face" class="headerlink" title="Track the Position and Orientation of a Face"></a>Track the Position and Orientation of a Face</h2><p>é¢éƒ¨è¿½è¸ªå¯ç”¨æ—¶ï¼Œ<code>ARKit</code>è‡ªåŠ¨ä¸ºè¿è¡Œçš„<em>AR session</em>æ·»åŠ <code>ARFaceAnchor</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†ç”¨æˆ·è„¸éƒ¨çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½ç½®å’Œæ–¹å‘ã€‚</p>
<blockquote>
<p><code>ARKit</code>åªç»™æ¢æµ‹å’Œæä¾›ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ã€‚å¦‚æœå¤šå¼ è„¸åœ¨æ‘„åƒå¤´å†…ï¼Œ<code>ARKit</code>é€‰æ‹©æœ€å¤§æœ€æ¸…æ™°çš„é‚£å¼ è„¸</p>
</blockquote>
<p>åœ¨åŸºäº<code>SceneKit</code>çš„ARä½“éªŒé‡Œï¼Œä½ å¯ä»¥åœ¨å¯¹åº”çš„<em>face anchor</em>é‡Œç”¨<strong>(_:didAdd:for:)</strong>æ·»åŠ 3Då†…å®¹ã€‚<code>ARKit</code>ä¸ºè¿™ä¸ª<em>anchor</em>æ·»åŠ ä¸€ä¸ª<code>SceneKit</code><em>node</em>ï¼Œå¹¶ä¸”åœ¨æ¯ä¸€å¸§æ›´æ–°<em>node</em>çš„ä½ç½®å’Œæ–¹å‘ï¼Œæ‰€ä»¥ä½ ç»™è¿™ä¸ª<em>node</em>æ·»åŠ çš„ä»»ä½•<code>SceneKit</code>å†…å®¹è‡ªåŠ¨çš„è·Ÿéšç”¨æˆ·è„¸éƒ¨çš„ä½ç½®å’Œæ–¹å‘ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">renderer</span><span class="params">(<span class="number">_</span> renderer: SCNSceneRenderer, didAdd node: SCNNode, <span class="keyword">for</span> anchor: ARAnchor)</span></span> &#123;</span><br><span class="line">    <span class="comment">// æŒæœ‰`faceNode`ï¼Œè¿™æ ·åœ¨åˆ‡æ¢å†…å®¹æ—¶ä¸å¿…é‡å¯*session*ã€‚</span></span><br><span class="line">    faceNode = node</span><br><span class="line">    serialQueue.async &#123;</span><br><span class="line">        <span class="keyword">self</span>.setupFaceNodeContent()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<strong>renderer(_:didAdd:for:)</strong>æ–¹æ³•é‡Œè°ƒç”¨äº†<strong>setupFaceNodeContent</strong>æ–¹æ³•æ¥ä¸º<code>SceneKit</code>å†…å®¹æ·»åŠ <strong>faceNode</strong>ã€‚å¦‚æœä½ åœ¨ä»£ç é‡Œæ”¹å˜<strong>showsCoordinateOrigin</strong>å˜é‡çš„å€¼ï¼Œä¼šåœ¨<em>node</em>ä¸Šå¢åŠ ä¸€ä¸ªå¯è§çš„x/y/zåæ ‡è½´ï¼Œæ ‡è¯†<em>face anchor</em>åæ ‡ç³»çš„åŸç‚¹ã€‚ </p>
<h2 id="Use-Face-Geometry-to-Model-the-Userâ€™s-Face"><a href="#Use-Face-Geometry-to-Model-the-Userâ€™s-Face" class="headerlink" title="Use Face Geometry to Model the Userâ€™s Face"></a>Use Face Geometry to Model the Userâ€™s Face</h2><p><code>ARKit</code>æä¾›ä¸€ä¸ªç²—ç•¥çš„åŒ¹é…ç”¨æˆ·è„¸éƒ¨çš„å¤§å°ã€å½¢çŠ¶ã€æ‹–å¸ƒç»“æ„ã€å½“å‰è¡¨æƒ…çš„3Dç½‘çŠ¶å‡ ä½•<em>geometry</em>ã€‚<code>ARKit</code>ä¹Ÿæä¾›<br><code>ARSCNFaceGeometry</code>ç±»ï¼Œæä¾›ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å¯è§†åŒ–è¿™ä¸ªç½‘ã€‚</p>
<p>ä½ çš„ARåº”ç”¨å¯ä»¥ç”¨è¿™ä¸ªç½‘æ¥æ”¾ç½®æˆ–è€…ç»˜åˆ¶è´´è„¸å†…å®¹ã€‚æ¯”å¦‚ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåŠé€æ˜çš„çº¹ç†åˆ°è¿™ä¸ª<em>geometry</em>ä¸Šï¼Œä½ å¯ä»¥åœ¨ç”¨æˆ·çš®è‚¤ä¸Šç”»è™šæ‹Ÿçš„çº¹èº«æˆ–è€…åŒ–å¦†ã€‚</p>
<p>ä¸ºäº†åˆ›å»ºä¸€ä¸ª<code>SceneKit</code>è„¸éƒ¨å‡ ä½•ï¼Œåˆå§‹åŒ–ä¸€ä¸ª<code>ARSCNFaceGeometry</code>å¯¹è±¡:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This relies on the earlier check of `ARFaceTrackingConfiguration.isSupported`.</span></span><br><span class="line"><span class="keyword">let</span> device = sceneView.device!</span><br><span class="line"><span class="keyword">let</span> maskGeometry = <span class="type">ARSCNFaceGeometry</span>(device: device)!</span><br></pre></td></tr></table></figure>
<p><strong>setupFaceNodeContent</strong>æ–¹æ³•ç»™<em>scene</em>æ·»åŠ äº†ä¸€ä¸ªåŒ…å«<em>face geometry</em>çš„<em>node</em>ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªé¢éƒ¨ã€‚ç”±äºè¿™ä¸ª<em>node</em>æ˜¯è¢«å›è°ƒæ–¹æ³•æä¾›çš„<em>face node</em>çš„<em>child node</em>ï¼Œæ‰€ä»¥å®ƒä¼šè‡ªåŠ¨çš„è·Ÿè¸ªç”¨æˆ·è„¸éƒ¨çš„ä½ç½®å’Œæ–¹å‘ã€‚ä½†æ˜¯ä¸ºäº†ä¹Ÿè®©å®ƒè·Ÿè¸ªç”¨æˆ·è„¸éƒ¨çš„å½¢çŠ¶ï¼ŒåŒ…æ‹¬çœ¨çœ¼ã€è®²è¯ã€å„ç§é¢éƒ¨è¡¨æƒ…ï¼Œä½ éœ€è¦åœ¨<strong>renderer(_:didUpdate:for:)</strong>æ›´æ–°å®ƒçš„<em>geometry</em>ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">renderer</span><span class="params">(<span class="number">_</span> renderer: SCNSceneRenderer, didUpdate node: SCNNode, <span class="keyword">for</span> anchor: ARAnchor)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> faceAnchor = anchor <span class="keyword">as</span>? <span class="type">ARFaceAnchor</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    </span><br><span class="line">    virtualFaceNode?.update(withFaceAnchor: faceAnchor)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(withFaceAnchor anchor: ARFaceAnchor)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> faceGeometry = geometry <span class="keyword">as</span>! <span class="type">ARSCNFaceGeometry</span></span><br><span class="line">    faceGeometry.update(from: anchor.geometry)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Place-3D-Content-on-the-Userâ€™s-Face"><a href="#Place-3D-Content-on-the-Userâ€™s-Face" class="headerlink" title="Place 3D Content on the Userâ€™s Face"></a>Place 3D Content on the Userâ€™s Face</h2><p>å¦ä¸€ä¸ªä½¿ç”¨<code>ARKit</code>æä¾›çš„é¢éƒ¨ç½‘ç»œçš„ç”¨æ³•æ˜¯åˆ›å»ºä¸€ä¸ª<em>occlusion geometry</em>(ğŸ˜¦è¿™ä¸ªæœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ç¡®å®ä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘)ã€‚<em>occlusion geometry</em>æ˜¯ä¸€ä¸ª3Dæ¨¡å‹ï¼Œå®ƒä¸æ¸²æŸ“ä»»ä½•å¯è§å†…å®¹ï¼ˆå…è®¸ç›¸æœºå›¾ç‰‡ç©¿è¿‡ï¼‰ï¼Œä½†æ˜¯é˜»æ–­äº†å…¶ä»–è™šæ‹Ÿå†…å®¹çš„ç›¸æœºçš„<em>view</em>ã€‚</p>
<p>è¿™ä¸ªæŠ€å·§åˆ›é€ ä¸€ç§è„¸éƒ¨å’Œè™šæ‹Ÿå¯¹è±¡äº¤äº’çš„å‡è±¡ï¼Œå³ä½¿è„¸æ˜¯ä¸€ä¸ª2Dç›¸æœºå›¾ç‰‡ï¼Œè€Œè™šæ‹Ÿå†…å®¹æ˜¯ä¸€ä¸ªè¢«æ¸²æŸ“çš„3Då¯¹è±¡ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æ”¾ç½®ä¸€ä¸ª<em>occlusion geometry</em>å’Œè™šæ‹Ÿå¢¨é•œåœ¨ç”¨æˆ·è„¸ä¸Šï¼Œè„¸å¯ä»¥æŒ¡ä½å¢¨é•œçš„æ¡†æ¶ã€‚</p>
<p>ä¸ºäº†ç»™è„¸åˆ›å»ºä¸€ä¸ª<em>occlusion geometry</em>ï¼Œä»åˆ›å»ºä¸€ä¸ª<code>ARSCNFaceGeometry</code>å¯¹è±¡å¼€å§‹ï¼Œå‚ç…§ä¹‹å‰çš„ä¾‹å­ã€‚ç„¶è€Œï¼Œä»£æ›¿è®¾ç½®ç»™å¯¹è±¡çš„<em>material</em>ä¸€ä¸ªå¯è§çš„å¤–å½¢çš„æ˜¯ï¼Œè®¾ç½®<em>material</em>çš„æ¸²æŸ“depth:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">geometry.firstMaterial!.colorBufferWriteMask = []</span><br><span class="line">occlusionNode = <span class="type">SCNNode</span>(geometry: geometry)</span><br><span class="line">occlusionNode.renderingOrder = -<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæ¸²æŸ“äº†<em>depth</em>ï¼Œå…¶ä»–è¢«æ¸²æŸ“çš„å¯¹è±¡æ­£ç¡®çš„å‡ºç°åœ¨äº†å®ƒçš„å‰é¢æˆ–è€…åé¢ã€‚ç”±äºå®ƒæ²¡æœ‰æ¸²æŸ“é¢œè‰²ï¼Œç›¸æœºå›¾åƒä¹Ÿå‡ºç°äº†ã€‚sampleé‡Œç»“åˆäº†è¿™ä¸ªæŠ€å·§å’Œ<code>SceneKit</code>å¯¹è±¡ï¼Œæ”¾ç½®åœ¨äº†ç”¨æˆ·çœ¼å‰ï¼Œåˆ¶é€ äº†ä¸€ç§çœŸå®çš„è¢«ç”¨æˆ·çš„é¼»å­é®æŒ¡çš„å›¾åƒã€‚</p>
<p>ï¼ˆå…¶å®ä¸å¤ªç†è§£åŸç†ï¼‰</p>
<h2 id="Animate-a-Character-with-Blend-Shapes"><a href="#Animate-a-Character-with-Blend-Shapes" class="headerlink" title="Animate a Character with Blend Shapes"></a>Animate a Character with Blend Shapes</h2><p>é™¤äº†ä¸Šé¢çš„ä¾‹å­å¤–ï¼Œ<code>ARKit</code>ä¹Ÿæä¾›ä¸€ç§æ›´æŠ½è±¡çš„ç”¨æˆ·é¢éƒ¨è¡¨æƒ…æ¨¡å‹ï¼Œç”¨ä¸€ä¸ª<code>blendShapes</code>å­—å…¸çš„å½¢å¼ã€‚ä½ å¯ä»¥ç”¨å­—å…¸é‡Œçš„å¤šä¸ªå€¼å»æ§åˆ¶ä½ çš„2Dæˆ–è€…3Dèµ„æºçš„åŠ¨ç”»å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªç‰¹å¾ï¼ˆæ¯”å¦‚å¤´åƒæˆ–è€…æœ¨å¶ï¼‰ï¼Œè·Ÿéšç”¨æˆ·çš„é¢éƒ¨ç§»åŠ¨å’Œè¡¨æƒ…ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ª<em>blend shape</em>çš„åŸºç¡€ç¤ºä¾‹ï¼Œè¿™ä¸ªsampleåŒ…æ‹¬äº†ä¸€ä¸ªç®€å•çš„æœºå™¨äººå¤´éƒ¨æ¨¡å‹ï¼Œæ˜¯ç”¨<code>SceneKit</code>çš„åŸºç¡€å½¢çŠ¶åˆ›é€ çš„ã€‚ï¼ˆåœ¨<em>robotHead.scn</em>æŸ¥çœ‹ï¼‰</p>
<p>ä¸ºäº†è·å–ç”¨æˆ·å½“å‰çš„é¢éƒ¨è¡¨æƒ…ï¼Œåœ¨<strong>renderer(_:didUpdate:for:)</strong> é‡Œè¯»å–<em>face anchor</em>çš„<code>blendShapes</code>å­—å…¸ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(withFaceAnchor faceAnchor: ARFaceAnchor)</span></span> &#123;</span><br><span class="line">    blendShapes = faceAnchor.blendShapes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæ£€æŸ¥å­—å…¸çš„é”®å€¼å¯¹æ¥è®¡ç®—åŠ¨ç”»å‚æ•°ã€‚è¿™é‡Œæœ‰52ä¸ªç‹¬ä¸€æ— äºŒçš„<code>ARFaceAnchor.BlendShapeLocation</code>å‚æ•°ã€‚ä½ çš„appå¯ä»¥å°½å¯èƒ½å°‘ä¹Ÿå¯ä»¥å°½å¯èƒ½å¤šçš„ä½¿ç”¨å®ƒä»¬æ¥åˆ›é€ ä½ æƒ³è¦çš„è‰ºæœ¯æ•ˆæœã€‚åœ¨è¿™ä¸ªç¤ºä¾‹å·¥ç¨‹é‡Œï¼Œ<code>RobotHead</code>å®Œæˆäº†è¿™ä¸ªè®¡ç®—ï¼Œè½¬æ¢<code>eyeBlinkLeft</code>å’Œ<code>eyeBlinkRight</code>å‚æ•°åˆ°æœºå™¨äººçœ¼ç›çš„å¤§å°å‚æ•°ï¼Œç”¨<code>jawOpen</code>æ¥åç§»æœºå™¨äººä¸‹å·´ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> blendShapes: [<span class="type">ARFaceAnchor</span>.<span class="type">BlendShapeLocation</span>: <span class="type">Any</span>] = [:] &#123;</span><br><span class="line">    <span class="keyword">didSet</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> eyeBlinkLeft = blendShapes[.eyeBlinkLeft] <span class="keyword">as</span>? <span class="type">Float</span>,</span><br><span class="line">            <span class="keyword">let</span> eyeBlinkRight = blendShapes[.eyeBlinkRight] <span class="keyword">as</span>? <span class="type">Float</span>,</span><br><span class="line">            <span class="keyword">let</span> jawOpen = blendShapes[.jawOpen] <span class="keyword">as</span>? <span class="type">Float</span></span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        eyeLeftNode.scale.z = <span class="number">1</span> - eyeBlinkLeft</span><br><span class="line">        eyeRightNode.scale.z = <span class="number">1</span> - eyeBlinkRight</span><br><span class="line">        jawNode.position.y = originalJawY - jawHeight * jawOpen</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2018/11/27/SlideMenuViewController/" data-toggle="tooltip" data-placement="top" title="SlideMenuViewController">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2018/03/21/PullingHeader/" data-toggle="tooltip" data-placement="top" title="PullingHeader">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                
                <!-- disqus è¯„è®ºæ¡† start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus è¯„è®ºæ¡† end -->
                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#iOSå¼€å‘" title="iOSå¼€å‘">iOSå¼€å‘</a>
                        
                          <a class="tag" href="/tags/#AR" title="AR">AR</a>
                        
                          <a class="tag" href="/tags/#ARKit(å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ï¼‰" title="ARKit(å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ï¼‰">ARKit(å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ï¼‰</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="#" target="_blank">Void</a></li>
                    
                        <li><a href="#" target="_blank">Placeholder</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>




<!-- disqus å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "blurrysskys-name";
    var disqus_identifier = "https://blurryssky.github.io/2018/03/26/Creating Face-Based AR Experiences(è¯‘)/";
    var disqus_url = "https://blurryssky.github.io/2018/03/26/Creating Face-Based AR Experiences(è¯‘)/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus å…¬å…±JSä»£ç  end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank" href="https://github.com/blurryssky">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; blurryssky&#39;s blog 2019 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://blurryssky.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-112182838-1';
    var _gaDomain = 'blurryssky.github.io';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="https://blurryssky.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
